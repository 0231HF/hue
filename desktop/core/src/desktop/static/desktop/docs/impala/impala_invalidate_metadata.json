{"body":"<div><p>\n      The <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> statement marks the metadata for one or all\n      tables as stale. The next time the Impala service performs a query against a table whose\n      metadata is invalidated, Impala reloads the associated metadata before the query proceeds.\n      As this is a very expensive operation compared to the incremental metadata update done by\n      the <span class=\"sql-docs-inline-code\">REFRESH</span> statement, when possible, prefer <span class=\"sql-docs-inline-code\">REFRESH</span>\n      rather than <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span>.\n    </p><p><span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> is required when the following changes are made\n      outside of Impala, in Hive and other Hive client, such as SparkSQL:\n      <ul><li>\n          Metadata of existing tables changes.\n        </li><li>\n          New tables are added, and Impala will use the tables.\n        </li><li>\n          The <span class=\"sql-docs-inline-code\">SERVER</span> or <span class=\"sql-docs-inline-code\">DATABASE</span> level Sentry privileges are\n          changed.\n        </li><li>\n          Block metadata changes, but the files remain the same (HDFS rebalance).\n        </li><li>\n          UDF jars change.\n        </li><li>\n          Some tables are no longer queried, and you want to remove their metadata from the\n          catalog and coordinator caches to reduce memory requirements.\n        </li></ul></p><p>\n      No <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> is needed when the changes are made by\n      <span class=\"sql-docs-inline-code\">impalad</span>.\n    </p><p>\n      See <span>intro metastore</span> for the information about the way\n      Impala uses metadata and how it shares the same metastore database as Hive.\n    </p><p>\n      Once issued, the <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> statement cannot be cancelled.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_syntax_blurb\"><b>Syntax:</b></p><div class=\"sql-docs-code-block\">INVALIDATE METADATA [[<span class=\"sql-docs-variable\">db_name</span>.]<span class=\"sql-docs-variable\">table_name</span>]</div><p>\n      If there is no table specified, the cached metadata for all tables is flushed and synced\n      with Hive Metastore (HMS). If tables were dropped from the HMS, they will be removed from\n      the catalog, and if new tables were added, they will show up in the catalog.\n    </p><p>\n      If you specify a table name, only the metadata for that one table is flushed and synced\n      with the HMS.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_usage_notes_blurb\"><b>Usage notes:</b></p><p>\n      To return accurate query results, Impala need to keep the metadata current for the\n      databases and tables queried. Therefore, if some other entity modifies information used by\n      Impala in the metastore, the information cached by Impala must be updated via\n      <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> or <span class=\"sql-docs-inline-code\">REFRESH</span>.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_refresh_vs_invalidate\"><span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> and <span class=\"sql-docs-inline-code\">REFRESH</span> are\n        counterparts:\n      <ul><li><span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> is an asynchronous operations\n            that simply discards the loaded metadata from the catalog and\n            coordinator caches. After that operation, the catalog and all the\n            Impala coordinators only know about the existence of databases and\n            tables and nothing more. Metadata loading for tables is triggered by\n            any subsequent queries.\n          </li><li><span class=\"sql-docs-inline-code\">REFRESH</span> reloads the metadata synchronously.\n              <span class=\"sql-docs-inline-code\">REFRESH</span> is more lightweight than doing a full\n            metadata load after a table has been invalidated.\n              <span class=\"sql-docs-inline-code\">REFRESH</span> cannot detect changes in block locations\n            triggered by operations like HDFS balancer, hence causing remote\n            reads during query execution with negative performance implications.\n          </li></ul></p><p>\n      Use <span class=\"sql-docs-inline-code\">REFRESH</span> after invalidating a specific table to separate the metadata\n      load from the first query that's run against that table.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_example_blurb\"><b>Examples:</b></p><p>\n      This example illustrates creating a new database and new table in Hive, then doing an\n      <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> statement in Impala using the fully qualified table\n      name, after which both the new table and the new database are visible to Impala.\n    </p><p>\n      Before the <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> statement was issued, Impala would give a\n      <q>not found</q> error if you tried to refer to those database or table names.\n    </p><div class=\"sql-docs-code-block\">$ hive<br/>hive> CREATE DATABASE new_db_from_hive;<br/>hive> CREATE TABLE new_db_from_hive.new_table_from_hive (x INT);<br/>hive> quit;<br/><br/>$ impala-shell<br/>> REFRESH new_db_from_hive.new_table_from_hive;<br/>ERROR: AnalysisException: Database does not exist: new_db_from_hive<br/><br/>> INVALIDATE METADATA new_db_from_hive.new_table_from_hive;<br/><br/>> SHOW DATABASES LIKE 'new*';<br/>+--------------------+<br/>| new_db_from_hive   |<br/>+--------------------+<br/><br/>> SHOW TABLES IN new_db_from_hive;<br/>+---------------------+<br/>| new_table_from_hive |<br/>+---------------------+</div><p>\n      Use the <span class=\"sql-docs-inline-code\">REFRESH</span> statement for incremental metadata update.\n    </p><div class=\"sql-docs-code-block\"><br/>> REFRESH new_table_from_hive;<br/></div><p>\n      For more examples of using <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> with a combination of\n      Impala and Hive operations, see\n      <span>tutorial impala hive</span>.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_hdfs_blurb\"><b>HDFS considerations:</b></p><p>\n      By default, the <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> command checks HDFS permissions of\n      the underlying data files and directories, caching this information so that a statement\n      can be cancelled immediately if for example the <span class=\"sql-docs-inline-code\">impala</span> user does not have\n      permission to write to the data directory for the table. (This checking does not apply\n      when the <span class=\"sql-docs-inline-code\">catalogd</span> configuration option\n      <span class=\"sql-docs-inline-code\">--load_catalog_in_background</span> is set to <span class=\"sql-docs-inline-code\">false</span>, which it\n      is by default.) Impala reports any lack of write permissions as an <span class=\"sql-docs-inline-code\">INFO</span>\n      message in the log file.\n    </p><p>\n      If you change HDFS permissions to make data readable or writeable by the Impala user,\n      issue another <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span> to make Impala aware of the change.\n    </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_kudu_blurb\"><b>Kudu considerations:</b></p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_kudu_metadata_intro\">\n        Much of the metadata for Kudu tables is handled by the underlying\n        storage layer. Kudu tables have less reliance on the metastore\n        database, and require less metadata caching on the Impala side.\n        For example, information about partitions in Kudu tables is managed\n        by Kudu, and Impala does not cache any block locality metadata\n        for Kudu tables.\n      </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_kudu_metadata_details\">\n        The <span class=\"sql-docs-inline-code\">REFRESH</span> and <span class=\"sql-docs-inline-code\">INVALIDATE METADATA</span>\n        statements are needed less frequently for Kudu tables than for\n        HDFS-backed tables. Neither statement is needed when data is\n        added to, removed, or updated in a Kudu table, even if the changes\n        are made directly to Kudu through a client program using the Kudu API.\n        Run <span class=\"sql-docs-inline-code\">REFRESH <span class=\"sql-docs-variable\">table_name</span></span> or\n        <span class=\"sql-docs-inline-code\">INVALIDATE METADATA <span class=\"sql-docs-variable\">table_name</span></span>\n        for a Kudu table only after making a change to the Kudu table schema,\n        such as adding or dropping a column.\n      </p><p id=\"../Impala/docs/topics/impala_invalidate_metadata.xml_related_info\"><b>Related information:</b></p><p><span>intro metastore</span>,\n      <a href=\"javascript: void(0);\" class=\"lang-ref-link\" data-target=\"topics/impala_refresh.xml#refresh\">REFRESH Statement</a></p></div>","title":"INVALIDATE METADATA Statement"}